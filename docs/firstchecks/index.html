<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Writing your first suite of checks · Spark Data Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Introduction to ChecksSuite"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Writing your first suite of checks · Spark Data Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://timgent.github.io/spark-data-quality/"/><meta property="og:description" content="## Introduction to ChecksSuite"/><meta property="og:image" content="https://timgent.github.io/spark-data-quality/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://timgent.github.io/spark-data-quality/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/spark-data-quality/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/spark-data-quality/js/scrollSpy.js"></script><link rel="stylesheet" href="/spark-data-quality/css/main.css"/><script src="/spark-data-quality/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/spark-data-quality/"><img class="logo" src="/spark-data-quality/img/favicon.ico" alt="Spark Data Quality"/><h2 class="headerTitleWithLogo">Spark Data Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/spark-data-quality/docs/intro" target="_self">Docs</a></li><li class=""><a href="/spark-data-quality/api/index.html" target="_self">API</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Getting Started</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/intro">Introduction</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/spark-data-quality/docs/firstchecks">Writing your first suite of checks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Available Checks</h3><ul class=""><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Metrics based checks</h4><ul><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/metricsintro">Introduction to metrics and metric based checks</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/metricssingledschecks">Metrics based checks on a single Dataset</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/metricsdualdschecks">Metrics based checks on a pair of Datasets</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/availablemetrics">Available metrics</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Arbitrary checks</h4><ul><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/arbchecksintro">Introduction to arbitrary checks</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/arbcheckssingleds">Arbitrary checks on a single dataset</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/arbchecksother">Completely arbitrary checks</a></li></ul></div><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/deequchecks">Deequ-based checks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Persisting your results</h3><ul class=""><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/qcresultspersistence">Persisting results from your checks</a></li><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/metricspersistence">Persisting metrics over time</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Developer docs</h3><ul class=""><li class="navListItem"><a class="navItem" href="/spark-data-quality/docs/developerdocs">Developer documentation</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Writing your first suite of checks</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction-to-checkssuite"></a><a href="#introduction-to-checkssuite" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction to ChecksSuite</h2>
<p>The entry point for any SDQ job is a <code>ChecksSuite</code>. You can pass in some metadata about the checksuite, details of the
checks to perform, your repositories for storing metrics and results, and rules about how to calculate an overall
check status. For example:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> com.github.timgent.sparkdataquality.checkssuite.<span class="hljs-type">ChecksSuite</span>
<span class="hljs-keyword">val</span> myFirstChecksSuite = <span class="hljs-type">ChecksSuite</span>(
    checkSuiteDescription = <span class="hljs-string">"myFirstChecksSuite"</span>,
    tags = ???,
    singleDatasetMetricChecks = ???,
    dualDatasetMetricChecks = ???,
    singleDatasetChecks = ???,
    dualDatasetChecks = ???,
    arbitraryChecks = ???,
    deequChecks = ???,
    metricsPersister = ???,
    deequMetricsRepository = ???,
    qcResultsRepository = ???,
    checkResultCombiner = ???
)
</code></pre>
<p>Check out the <a href="/spark-data-quality/api/index.html">API docs</a> for full details of the arguments for a ChecksSuite. The most important thing
to know is that all of these arguments except for checkSuiteDescription are optional. We recommend just specifying the
items you are interested in. Where you don't provide arguments either no checks of that type will be run or the metrics
or the QC Results won't be stored. The default value for <code>tags</code> is an empty map. The default <code>checkResultCombiner</code> will
use the worst status for any individual checks as the overall status for the <code>ChecksSuiteResult</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="a-simple-checkssuite"></a><a href="#a-simple-checkssuite" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A simple ChecksSuite</h2>
<p>Let's look at a simple example where we run some performant metric-based checks a single Dataset.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> java.time.<span class="hljs-type">Instant</span>

  <span class="hljs-keyword">import</span> com.github.timgent.sparkdataquality.checks.metrics.<span class="hljs-type">SingleMetricBasedCheck</span>
  <span class="hljs-keyword">import</span> com.github.timgent.sparkdataquality.checkssuite._
  <span class="hljs-keyword">import</span> com.github.timgent.sparkdataquality.thresholds.<span class="hljs-type">AbsoluteThreshold</span>
  <span class="hljs-keyword">import</span> org.apache.spark.<span class="hljs-type">SparkConf</span>
  <span class="hljs-keyword">import</span> org.apache.spark.sql.{<span class="hljs-type">Dataset</span>, <span class="hljs-type">SparkSession</span>}

  <span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContext</span>.<span class="hljs-type">Implicits</span>.global
  <span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">Future</span>
  <span class="hljs-keyword">val</span> sparkConf = <span class="hljs-keyword">new</span> <span class="hljs-type">SparkConf</span>().setAppName(<span class="hljs-string">"SimpleChecksSuite"</span>).setMaster(<span class="hljs-string">"local"</span>)
  <span class="hljs-keyword">val</span> spark = <span class="hljs-type">SparkSession</span>.builder().config(sparkConf).getOrCreate()
  <span class="hljs-keyword">import</span> spark.implicits._
  <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NumberString</span>(<span class="hljs-params">num: <span class="hljs-type">Int</span>, string: <span class="hljs-type">String</span></span>)</span>
  <span class="hljs-keyword">val</span> ds: <span class="hljs-type">Dataset</span>[<span class="hljs-type">NumberString</span>] = <span class="hljs-type">List</span>(
    <span class="hljs-type">NumberString</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"a"</span>),
    <span class="hljs-type">NumberString</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>),
    <span class="hljs-type">NumberString</span>(<span class="hljs-number">3</span>, <span class="hljs-string">"c"</span>)
  ).toDS
  <span class="hljs-keyword">val</span> numberStrings: <span class="hljs-type">DescribedDataset</span> = <span class="hljs-type">DescribedDataset</span>(ds, <span class="hljs-string">"numberStrings"</span>)
  <span class="hljs-keyword">val</span> simpleChecksSuite: <span class="hljs-type">ChecksSuite</span> = <span class="hljs-type">ChecksSuite</span>(
    checkSuiteDescription = <span class="hljs-string">"simpleChecksSuite"</span>,
    singleDatasetMetricChecks = <span class="hljs-type">Seq</span>(
      <span class="hljs-type">SingleDatasetMetricChecks</span>(
        numberStrings,
        <span class="hljs-type">Seq</span>(
          <span class="hljs-type">SingleMetricBasedCheck</span>.sizeCheck(<span class="hljs-type">AbsoluteThreshold</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)),
          <span class="hljs-type">SingleMetricBasedCheck</span>.distinctValuesCheck(<span class="hljs-type">AbsoluteThreshold</span>(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>), <span class="hljs-type">List</span>(<span class="hljs-string">"num"</span>)))
      )
    )
  )
  <span class="hljs-keyword">val</span> qcResults: <span class="hljs-type">Future</span>[<span class="hljs-type">ChecksSuiteResult</span>] = simpleChecksSuite.run(<span class="hljs-type">Instant</span>.now)
</code></pre>
<p>In this case we're defining a ChecksSuite that does just 2 checks, both on the same Dataset. One checks the size
of the Dataset is between 3 and 5, and the other checks that there are between 2 and 5 distinct numbers. Because no
repository is provided for the results, and no Persister is provided for the metrics, no persistence of results or
metrics will take place.</p>
<p>You'll find some more details about the different types of checks you can do, and how to persist your results and your
metrics in the other sections of the documentation.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/spark-data-quality/docs/intro"><span class="arrow-prev">← </span><span>Introduction</span></a><a class="docs-next button" href="/spark-data-quality/docs/metricsintro"><span>Introduction to metrics and metric based checks</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction-to-checkssuite">Introduction to ChecksSuite</a></li><li><a href="#a-simple-checkssuite">A simple ChecksSuite</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/spark-data-quality/" class="nav-home"><img src="/spark-data-quality/img/favicon.ico" alt="Spark Data Quality" width="66" height="58"/></a><div><h5>Docs</h5><a href="/spark-data-quality/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/spark-data-quality/docs/en/doc2.html">Guides (or other categories)</a><a href="/spark-data-quality/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/spark-data-quality/en/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/spark-data-quality/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/spark-data-quality/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Tim Gent</section></footer></div></body></html>